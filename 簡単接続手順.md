# スマホ連携 - 簡単接続手順

## 🚀 3ステップで完了！

### Step 1: PCでIPアドレスを確認

PowerShellまたはコマンドプロンプトで実行：
```powershell
ipconfig
```

出力例：
```
イーサネット アダプター イーサネット:
   IPv4 アドレス . . . . . . . . . . . .: 192.168.1.100  ← これをメモ
```

### Step 2: EYM Agentを起動

```bash
# Web版の場合
flutter run -d chrome

# Windows ネイティブ版の場合
flutter run -d windows
```

アプリが起動すると、画面に `http://localhost:8765` と表示されますが、**これはPC内部用のアドレスです。**

### Step 3: スマホ側で実際のIPアドレスを使用

スマホの既存MVPアプリで、以下のように変更：

#### 変更前（動作しない）
```dart
final String serverUrl = 'http://localhost:8765';
```

#### 変更後（正しい）
```dart
final String serverUrl = 'http://192.168.1.100:8765'; // Step1で確認したIPアドレス
```

## 📱 実際の使用例

### スマホアプリのコード
```dart
class EYMRemoteController {
  // Step1で確認したIPアドレスを設定
  static const String serverUrl = 'http://192.168.1.100:8765';
  
  // ボタン1を押したときの処理
  static Future<void> pressButton1() async {
    await _sendCommand(1);
  }
  
  // ボタン2を押したときの処理
  static Future<void> pressButton2() async {
    await _sendCommand(2);
  }
  
  // 共通の送信処理
  static Future<void> _sendCommand(int buttonId) async {
    try {
      final response = await http.post(
        Uri.parse('$serverUrl/launch'),
        headers: {'Content-Type': 'application/json'},
        body: jsonEncode({'button_id': buttonId}),
      );
      
      if (response.statusCode == 200) {
        final result = jsonDecode(response.body);
        print('成功: ${result['message']}');
      } else {
        print('エラー: ${response.statusCode}');
      }
    } catch (e) {
      print('接続エラー: $e');
    }
  }
}
```

### 使用方法
```dart
// ボタンウィジェット
ElevatedButton(
  onPressed: () => EYMRemoteController.pressButton1(),
  child: Text('PC アプリ起動'),
)
```

## 🔧 接続テスト方法

### 1. PCのブラウザでテスト
```
http://192.168.1.100:8765/health
```
→ "ok" が表示されればサーバー起動中

### 2. スマホのブラウザでテスト
同じURLをスマホのブラウザで開く：
```
http://192.168.1.100:8765/health
```
→ "ok" が表示されれば接続成功！

## ⚠️ よくある問題と解決方法

### 問題1: スマホから接続できない
**解決**: 
1. PCとスマホが同じWi-Fiに接続されているか確認
2. IPアドレスが正しいか再確認（`ipconfig`で再確認）

### 問題2: ファイアウォールエラー
**解決**: 
- EYM Agent初回起動時に「ネットワークアクセスを許可しますか？」→「許可」をクリック
- または、Windows Defenderファイアウォールでポート8765を手動で許可

### 問題3: IPアドレスが変わる
**解決**: 
- ルーターの設定でPCに固定IPアドレスを割り当て
- または、毎回 `ipconfig` で確認してスマホアプリを更新

## 📋 チェックリスト

- [ ] PCで `ipconfig` を実行してIPアドレスを確認
- [ ] EYM Agentを起動（Web版またはネイティブ版）
- [ ] PCブラウザで `http://[IPアドレス]:8765/health` をテスト
- [ ] スマホブラウザで同じURLをテスト
- [ ] スマホアプリのサーバーURLを実際のIPアドレスに変更
- [ ] スマホアプリからボタンを押してテスト

## 🎯 まとめ

1. **PCのIPアドレス確認**: `ipconfig`
2. **スマホアプリ修正**: `http://[実際のIPアドレス]:8765`
3. **テスト**: スマホブラウザで接続確認

これだけで、スマホからPCのアプリケーションを起動できます！
